!function(){"use strict";angular.module("ionic-http-offline-cache",[]).provider("httpOfflineCache",function(){function e(e,t){if(angular.isArray(e)){t=t||[];for(var n=0,r=e.length;r>n;n++)t[n]=e[n]}else if(angular.isObject(e)){t=t||{};for(var o in e)("$"!==o.charAt(0)||"$"!==o.charAt(1))&&(t[o]=e[o])}return t||e}function t(e){return"[object File]"===toString.call(e)}function n(e){return"[object Blob]"===toString.call(e)}function r(e){return"[object FormData]"===toString.call(e)}function o(e){var t=e.match(c);return t&&f[t[0]].test(e)}function i(e,t){if(angular.isString(e)){var n=e.replace(l,"").trim();if(n){var r=t("Content-Type");(r&&0===r.indexOf(a)||o(n))&&(e=angular.fromJson(n))}}return e}var a="application/json",u={"Content-Type":a+";charset=utf-8"},c=/^\[|^\{(?!\{)/,f={"[":/]$/,"{":/}$/},l=/^\)\]\}',?\n/;this.defaults={transformResponse:[i],transformRequest:[function(e){return!angular.isObject(e)||t(e)||n(e)||r(e)?e:angular.toJson(e)}],headers:{common:{Accept:"application/json, text/plain, */*"},post:e(u),put:e(u),patch:e(u)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",paramSerializer:"$httpParamSerializer"},this.$get=["$window","$http","$q","httpOfflineCacheStorage",function(e,t,n,r){function o(e,r){return i()?a(e,r):t.get(e,r).then(function(t){return u(t,e,r)})["catch"](function(t){return t.status?n.reject(t):a(e,r)})}function i(){return f=e.navigator&&e.navigator.connection,l=e.Connection&&e.Connection.NONE,f?f.type===l:!1}function a(e,t){return r.get(e).then(function(e){return e?e.response:n.reject({status:0,data:"",headers:function(){return""},config:t,statusText:""})})}function u(e,t,n){return r.set(t,{response:e,config:n}),e}function c(e){return e&&"GET"===e.method?o(e.url,e):t(e)}var f=e.navigator&&e.navigator.connection,l=e.Connection&&e.Connection.NONE;return c.get=o,c.head=t.head.bind(t),c.post=t.post.bind(t),c.put=t.put.bind(t),c["delete"]=t["delete"].bind(t),c.jsonp=t.jsonp.bind(t),c.patch=t.patch.bind(t),c.isOffline=i,c.pendingRequests=t.pendingRequests,c.defaults=t.defaults,c}]})}(),function(){"use strict";angular.module("ionic-http-offline-cache").provider("httpOfflineCacheStorage",function(){var e,t,n="sqlite",r="localStorage",o="inMemory",i=[n,r,o],a=[n,r,o];this.setBackends=function(e){e.forEach(function(e){if(i.indexOf(e)<0)throw new Error("Invalid backend type for HttpOfflineCache "+e)}),a=e},this.$get=["$window","$q",function(i,u){function c(){function e(){if(!n)return u.reject(!1);if(r)return u.resolve(!0);if(r=n.openDatabase({name:"httpOfflineCache.db",location:2}),!r)throw new Error("SQLite3 could not be initialized");return t("CREATE TABLE IF NOT EXISTS items (id TEXT PRIMARY KEY, val TEXT)").then(function(){return!0})}function t(t,n){var o=u.defer();return n=n||[],e().then(function(){r.transaction(function(e){e.executeSql(t,n,function(e,t){o.resolve(t)},function(e){console.log("SQlite statement error: "+e.message),o.reject(e)})},function(e){console.log("SQlite trx error: "+e.message),o.reject(e)})}),o.promise}var n,r;return n=i.sqlitePlugin||i.SQLitePlugin,{isSupported:!!n,clear:function(){return t("DELETE FROM items")},has:function(e){return t("SELECT val FROM items WHERE id = ?",[e]).then(function(e){return e.rows.length>0})},get:function(e){return t("SELECT val FROM items WHERE id = ?",[e]).then(function(e){if(e.rows.length>0){var t=e.rows.item(0).val;return null===t||"undefined"==typeof t?void 0:angular.fromJson(t)}return void 0})},set:function(e,n){var r=angular.toJson(n);return t("REPLACE INTO items(id, val) VALUES (?, ?)",[e,r])},remove:function(e){return t("DELETE FROM items WHERE id = ?",[e])}}}function f(){var e="httpCache-";return{isSupported:function(){try{return"localStorage"in i&&null!==i.localStorage}catch(e){return!1}}(),clear:function(){for(var t=i.localStorage.length-1;t>=0;t--){var n=i.localStorage.key(t);0===n.indexOf(e)&&i.localStorage.removeItem(n)}return u.resolve(!0)},has:function(t){return u.resolve("undefined"!=typeof i.localStorage[e+t])},get:function(t){var n=i.localStorage.getItem(e+t);return null===n||"undefined"==typeof n?u.resolve(void 0):u.resolve(angular.fromJson(n))},set:function(t,n){var r=this,o=angular.toJson(n);try{i.localStorage.setItem(e+t,o)}catch(a){r.clear()}return u.resolve(!0)},remove:function(t){return i.localStorage.removeItem(e+t),u.resolve(!0)}}}function l(){var e={};return{isSupported:!0,clear:function(){return e={},u.resolve(!0)},has:function(t){return u.resolve("undefined"!=typeof e[t])},get:function(t){return u.resolve(e[t])},set:function(t,n){return e[t]=n,u.resolve(!0)},remove:function(t){return delete e[t],u.resolve(!0)}}}function s(){return t={startup:d,clear:function(){return e||d(),e.clear()},has:function(t){return e||d(),e.has(t)},get:function(t){return e||d(),e.get(t)},set:function(t,n){return e||d(),e.set(t,n)},remove:function(t){return e||d(),e.remove(t)}}}function d(){if(e=null,a.forEach(function(i){if(!e){if(i===n)e=c();else if(i===r)e=f();else{if(i!==o)throw new Error("Invalid backend type for HttpOfflineCache "+i);e=l()}t.type=e.type=i,e.isSupported||(e=null)}}),!e)throw new Error("No active storage backend for HttpOfflineCache ");return e}return s()}]})}();
//# sourceMappingURL=HttpOfflineCache.min.js.map
